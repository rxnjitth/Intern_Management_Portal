{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - {{ admin_name|default:"Admin" }} | IPS Interns</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="{% static 'css/admin_dashboard_new.css' %}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Left Panel / Sidebar -->
        <div class="left-panel" id="sidebar">
            <div class="bg-elements">
                <div class="wave wave-1"></div>
                <div class="wave wave-2"></div>
                <div class="circle circle-1"></div>
                <div class="circle circle-2"></div>
            </div>
            
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <img src="{% static 'images/ips_logo.webp' %}" alt="IPS Logo" class="sidebar-logo-img">
                    <span>IPS Interns</span>
                </div>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-title">Main Menu</div>
                <a href="{% url 'admin_dashboard' %}" class="nav-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{% url 'all_interns' %}" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>All Interns</span>
                </a>
                <a href="{% url 'internship_applications' %}" class="nav-link">
                    <i class="fas fa-file-alt"></i>
                    <span>Applications</span>
                </a>
                <a href="{% url 'certified_interns' %}" class="nav-link">
                    <i class="fas fa-certificate"></i>
                    <span>Certified Interns</span>
                </a>
                
                <div class="menu-title">Categories</div>
                <a href="{% url 'gender_interns' 'male' %}" class="nav-link">
                    <i class="fas fa-male"></i>
                    <span>Male Interns</span>
                </a>
                <a href="{% url 'gender_interns' 'female' %}" class="nav-link">
                    <i class="fas fa-female"></i>
                    <span>Female Interns</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <p>&copy; 2025 IPS Tech Community</p>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <button class="toggle-sidebar" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="admin-info">
                    <div class="admin-greeting">Welcome, <span class="admin-name">{{ admin_name|default:"Admin" }}</span>!</div>
                </div>
                
                <div class="admin-actions">
                    <div class="notification-bell{% if pending_applications > 0 %} has-notifications{% endif %}" id="notificationBell">
                        <i class="fas fa-bell"></i>
                        {% if pending_applications > 0 %}
                        <span class="notification-badge">{{ pending_applications }}</span>
                        {% endif %}
                    </div>
                    
                    <a href="{% url 'custom_logout' %}" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </div>
            
            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <!-- Welcome Banner -->
                <div class="welcome-banner fade-in">
                    <h1>Admin Dashboard</h1>
                    
                </div>
                
                <!-- Stats Grid -->
                <div class="stats-grid fade-in">
                    <!-- Total Interns -->
                    <div class="stat-card total-interns">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 class="stat-title">Total Interns</h3>
                        <div class="stat-value">{{ total_interns }}</div>
                    </div>
                    
                    <!-- Applications -->
                    <div class="stat-card applications">
                        <div class="stat-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3 class="stat-title">Internship Applications</h3>
                        <div class="stat-value">{{ pending_applications }}</div>
                    </div>
                    
                    <!-- Certified Interns -->
                    <div class="stat-card certified">
                        <div class="stat-icon">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <h3 class="stat-title">Certified Interns</h3>
                        <div class="stat-value">{{ certified_interns|default:"0" }}</div>
                    </div>
                    
                    <!-- Male Interns -->
                    <div class="stat-card male-interns">
                        <div class="stat-icon">
                            <i class="fas fa-male"></i>
                        </div>
                        <h3 class="stat-title">Male Interns</h3>
                        <div class="stat-value">{{ male_count }}</div>
                    </div>
                    
                    <!-- Female Interns -->
                    <div class="stat-card female-interns">
                        <div class="stat-icon">
                            <i class="fas fa-female"></i>
                        </div>
                        <h3 class="stat-title">Female Interns</h3>
                        <div class="stat-value">{{ female_count }}</div>
                    </div>
                </div>
                
                <!-- Download Section -->
                <div class="download-section fade-in">
                    <h3 class="download-title">Export Intern Data</h3>
                    <a href="{% url 'export_interns_excel' %}" class="download-btn">
                        <i class="fas fa-file-excel"></i>
                        <span>Download All Intern Data (Excel)</span>
                    </a>
                </div>
                
                <!-- Footer Message -->
                <div class="footer-message fade-in">
                    
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add animation classes to fade-in elements
            const fadeElements = document.querySelectorAll('.fade-in');
            fadeElements.forEach((el, index) => {
                setTimeout(() => {
                    el.classList.add('animate__animated', 'animate__fadeIn');
                }, index * 150);
            });
            
            // Toggle sidebar on mobile
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                });
                
                // Close sidebar when clicking outside of it
                document.addEventListener('click', function(event) {
                    if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
                        sidebar.classList.remove('show');
                    }
                });
            }
            
            // Dynamic notification bell
            const notificationBell = document.getElementById('notificationBell');
            if (notificationBell && notificationBell.classList.contains('has-notifications')) {
                // Add pulse animation to notification bell
                const pulseAnimation = () => {
                    notificationBell.classList.add('pulse-animation');
                    setTimeout(() => {
                        notificationBell.classList.remove('pulse-animation');
                    }, 1000);
                };
                
                // Initial pulse
                setTimeout(pulseAnimation, 2000);
                
                // Repeat pulse every 30 seconds
                setInterval(pulseAnimation, 30000);
                
                // Get application count
                const applicationCount = parseInt("{{ pending_applications|default:'0' }}");
                
                // Create notification popup
                notificationBell.addEventListener('click', function() {
                    // Create notification popup
                    const notificationPopup = document.createElement('div');
                    notificationPopup.className = 'notification-popup';
                    
                    // Create header with title and close button
                    const popupHeader = document.createElement('div');
                    popupHeader.className = 'notification-popup-header';
                    
                    const popupTitle = document.createElement('h5');
                    popupTitle.textContent = 'New Internship Applications';
                    
                    const closeButton = document.createElement('button');
                    closeButton.className = 'notification-close-btn';
                    closeButton.innerHTML = '&times;';
                    closeButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        document.body.removeChild(notificationPopup);
                    });
                    
                    popupHeader.appendChild(popupTitle);
                    popupHeader.appendChild(closeButton);
                    
                    // Create notification content
                    const popupContent = document.createElement('div');
                    popupContent.className = 'notification-popup-content';
                    
                    if (applicationCount > 0) {
                        const message = document.createElement('p');
                        message.innerHTML = `<b>${applicationCount}</b> new student${applicationCount !== 1 ? 's' : ''} applied for internship${applicationCount !== 1 ? 's' : ''}.`;
                        
                        const viewLink = document.createElement('a');
                        viewLink.href = "{% url 'internship_applications' %}";
                        viewLink.className = 'notification-link';
                        viewLink.textContent = 'View applications';
                        
                        popupContent.appendChild(message);
                        popupContent.appendChild(viewLink);
                    } else {
                        popupContent.textContent = 'No new internship applications at this time.';
                    }
                    
                    // Add all elements to popup
                    notificationPopup.appendChild(popupHeader);
                    notificationPopup.appendChild(popupContent);
                    
                    // Position popup and add to body
                    const bellRect = notificationBell.getBoundingClientRect();
                    notificationPopup.style.top = (bellRect.bottom + window.scrollY + 10) + 'px';
                    notificationPopup.style.right = (window.innerWidth - bellRect.right) + 'px';
                    
                    // Remove any existing popup before adding a new one
                    const existingPopup = document.querySelector('.notification-popup');
                    if (existingPopup) {
                        document.body.removeChild(existingPopup);
                    }
                    
                    document.body.appendChild(notificationPopup);
                    
                    // Close popup when clicking outside
                    setTimeout(() => {
                        document.addEventListener('click', function closePopup(e) {
                            if (!notificationPopup.contains(e.target) && e.target !== notificationBell) {
                                document.body.removeChild(notificationPopup);
                                document.removeEventListener('click', closePopup);
                            }
                        });
                    }, 10);
                });
                
                notificationBell.style.cursor = 'pointer';
                notificationBell.setAttribute('title', 'Click to view notifications');
            }
        });
    </script>
</body>
</html>